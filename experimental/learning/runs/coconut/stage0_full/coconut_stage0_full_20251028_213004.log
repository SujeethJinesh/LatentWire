W1028 21:30:06.273000 54120 site-packages/torch/distributed/run.py:793] 
W1028 21:30:06.273000 54120 site-packages/torch/distributed/run.py:793] *****************************************
W1028 21:30:06.273000 54120 site-packages/torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1028 21:30:06.273000 54120 site-packages/torch/distributed/run.py:793] *****************************************
/users/sujinesh/.conda/envs/3_11/lib/python3.11/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.conda/envs/3_11/lib/python3.11/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.conda/envs/3_11/lib/python3.11/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
Config: {'project': 'coconut', 'save_path': 'YOUR_PATH_TO_SAVE_THE_MODEL', 'name': 'gsm-cot', 'only_eval': False, 'coconut': False, 'cot': True, 'no_thoughts': False, 'no_cot': False, 'c_thought': 0, 'epochs_per_stage': 1, 'max_latent_stage': 0, 'pad_latent_to_max': True, 'save_only_improve': True, 'uniform_prob': 0.0, 'model_id': 'openai-community/gpt2', 'load_model_path': 'None', 'seed': 0, 'resume': 0, 'bf16': False, 'train_path': 'data/gsm_train.json', 'val_path': 'data/gsm_valid.json', 'reset_optimizer': False, 'batch_size_training': 32, 'debug': False, 'gradient_accumulation_steps': 1, 'num_epochs': 25, 'lr': 0.0001, 'weight_decay': 0.01}
[rank0]:[W1028 21:30:16.184732216 ProcessGroupNCCL.cpp:4115] [PG ID 0 PG GUID 0 Rank 0]  using GPU 0 to perform barrier as devices used by this process are currently unknown. This can potentially cause a hang if this rank to GPU mapping is incorrect.Specify device_ids in barrier() to force use of a particular device,or call init_process_group() with a device_id.
[rank1]:[W1028 21:30:17.388665460 ProcessGroupNCCL.cpp:4115] [PG ID 0 PG GUID 0 Rank 1]  using GPU 1 to perform barrier as devices used by this process are currently unknown. This can potentially cause a hang if this rank to GPU mapping is incorrect.Specify device_ids in barrier() to force use of a particular device,or call init_process_group() with a device_id.
[rank2]:[W1028 21:30:17.395245116 ProcessGroupNCCL.cpp:4115] [PG ID 0 PG GUID 0 Rank 2]  using GPU 2 to perform barrier as devices used by this process are currently unknown. This can potentially cause a hang if this rank to GPU mapping is incorrect.Specify device_ids in barrier() to force use of a particular device,or call init_process_group() with a device_id.
Running FSDP on rank = 0, world size = 3Running FSDP on rank = 2, world size = 3Running FSDP on rank = 1, world size = 3


FullyShardedDataParallel(
  (_fsdp_wrapped_module): GPT2LMHeadModel(
    (transformer): GPT2Model(
      (wte): Embedding(50257, 768)
      (wpe): Embedding(1024, 768)
      (drop): Dropout(p=0.1, inplace=False)
      (h): ModuleList(
        (0-11): 12 x GPT2Block(
          (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          (attn): GPT2SdpaAttention(
            (c_attn): Conv1D(nf=2304, nx=768)
            (c_proj): Conv1D(nf=768, nx=768)
            (attn_dropout): Dropout(p=0.1, inplace=False)
            (resid_dropout): Dropout(p=0.1, inplace=False)
          )
          (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          (mlp): GPT2MLP(
            (c_fc): Conv1D(nf=3072, nx=768)
            (c_proj): Conv1D(nf=768, nx=3072)
            (act): NewGELUActivation()
            (dropout): Dropout(p=0.1, inplace=False)
          )
        )
      )
      (ln_f): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
    )
    (lm_head): Linear(in_features=768, out_features=50257, bias=False)
  )
)
Map (num_proc=32):   0%|          | 0/500 [00:00<?, ? examples/s]Map (num_proc=32):   1%|▏         | 7/500 [00:00<01:02,  7.95 examples/s]Map (num_proc=32):   6%|▋         | 32/500 [00:01<00:12, 36.07 examples/s]Map (num_proc=32):  10%|▉         | 48/500 [00:01<00:10, 43.40 examples/s]Map (num_proc=32):  11%|█▏        | 57/500 [00:01<00:09, 46.89 examples/s]Map (num_proc=32):  14%|█▍        | 71/500 [00:01<00:07, 54.67 examples/s]Map (num_proc=32):  17%|█▋        | 86/500 [00:01<00:06, 63.25 examples/s]Map (num_proc=32):  19%|█▉        | 97/500 [00:02<00:07, 54.82 examples/s]Map (num_proc=32):  23%|██▎       | 113/500 [00:02<00:06, 62.21 examples/s]Map (num_proc=32):  29%|██▉       | 144/500 [00:02<00:04, 86.36 examples/s]Map (num_proc=32):  31%|███▏      | 157/500 [00:02<00:03, 89.88 examples/s]Map (num_proc=32):  35%|███▌      | 176/500 [00:02<00:04, 80.49 examples/s]Map (num_proc=32):  38%|███▊      | 192/500 [00:03<00:03, 79.91 examples/s]Map (num_proc=32):  42%|████▏     | 208/500 [00:03<00:03, 79.94 examples/s]Map (num_proc=32):  45%|████▍     | 224/500 [00:03<00:03, 76.78 examples/s]Map (num_proc=32):  48%|████▊     | 240/500 [00:03<00:03, 76.45 examples/s]Map (num_proc=32):  51%|█████     | 256/500 [00:03<00:02, 82.17 examples/s]Map (num_proc=32):  54%|█████▍    | 272/500 [00:04<00:02, 83.51 examples/s]Map (num_proc=32):  57%|█████▋    | 284/500 [00:04<00:02, 80.73 examples/s]Map (num_proc=32):  61%|██████    | 303/500 [00:04<00:02, 87.62 examples/s]Map (num_proc=32):  64%|██████▍   | 320/500 [00:04<00:01, 91.61 examples/s]Map (num_proc=32):  67%|██████▋   | 335/500 [00:04<00:01, 86.69 examples/s]Map (num_proc=32):  70%|███████   | 350/500 [00:05<00:01, 90.27 examples/s]Map (num_proc=32):  73%|███████▎  | 365/500 [00:05<00:01, 88.73 examples/s]Map (num_proc=32):  75%|███████▌  | 377/500 [00:05<00:01, 79.29 examples/s]Map (num_proc=32):  78%|███████▊  | 390/500 [00:05<00:01, 82.05 examples/s]Map (num_proc=32):  82%|████████▏ | 410/500 [00:05<00:01, 89.85 examples/s]Map (num_proc=32):  85%|████████▌ | 425/500 [00:05<00:00, 77.81 examples/s]Map (num_proc=32):  88%|████████▊ | 440/500 [00:06<00:01, 59.49 examples/s]Map (num_proc=32):  90%|█████████ | 452/500 [00:06<00:00, 54.47 examples/s]Map (num_proc=32):  94%|█████████▍| 470/500 [00:06<00:00, 71.50 examples/s]Map (num_proc=32): 100%|██████████| 500/500 [00:06<00:00, 97.27 examples/s]Map (num_proc=32): 100%|██████████| 500/500 [00:07<00:00, 70.02 examples/s]
Map (num_proc=32):   0%|          | 0/385620 [00:00<?, ? examples/s]Map (num_proc=32):   0%|          | 38/385620 [00:02<8:24:35, 12.74 examples/s]Map (num_proc=32):   0%|          | 161/385620 [00:03<1:34:12, 68.19 examples/s]Map (num_proc=32):   0%|          | 248/385620 [00:03<56:46, 113.13 examples/s] Map (num_proc=32):   0%|          | 367/385620 [00:03<32:42, 196.28 examples/s]Map (num_proc=32):   0%|          | 496/385620 [00:03<21:27, 299.13 examples/s]Map (num_proc=32):   0%|          | 596/385620 [00:03<18:11, 352.85 examples/s]Map (num_proc=32):   0%|          | 684/385620 [00:04<20:55, 306.71 examples/s]Map (num_proc=32):   0%|          | 827/385620 [00:04<16:30, 388.62 examples/s]Map (num_proc=32):   0%|          | 969/385620 [00:04<13:20, 480.50 examples/s]Map (num_proc=32):   0%|          | 1145/385620 [00:04<11:58, 534.94 examples/s]Map (num_proc=32):   0%|          | 1314/385620 [00:04<09:58, 641.60 examples/s]Map (num_proc=32):   0%|          | 1456/385620 [00:05<09:13, 694.68 examples/s]Map (num_proc=32):   0%|          | 1668/385620 [00:05<07:29, 853.94 examples/s]Map (num_proc=32):   0%|          | 1856/385620 [00:05<06:36, 968.20 examples/s]Map (num_proc=32):   1%|          | 2016/385620 [00:05<06:03, 1055.59 examples/s]Map (num_proc=32):   1%|          | 2162/385620 [00:05<05:38, 1133.94 examples/s]Map (num_proc=32):   1%|          | 2318/385620 [00:05<05:17, 1207.52 examples/s]Map (num_proc=32):   1%|          | 2530/385620 [00:05<04:44, 1347.74 examples/s]Map (num_proc=32):   1%|          | 2737/385620 [00:05<04:12, 1514.08 examples/s]Map (num_proc=32):   1%|          | 2934/385620 [00:06<04:16, 1489.71 examples/s]Map (num_proc=32):   1%|          | 3165/385620 [00:06<03:57, 1613.08 examples/s]Map (num_proc=32):   1%|          | 3348/385620 [00:06<05:03, 1260.15 examples/s]Map (num_proc=32):   1%|          | 3510/385620 [00:06<06:14, 1021.66 examples/s]Map (num_proc=32):   1%|          | 3795/385620 [00:06<06:29, 981.21 examples/s] Map (num_proc=32):   1%|          | 4093/385620 [00:07<04:52, 1302.22 examples/s]Map (num_proc=32):   1%|          | 4268/385620 [00:07<05:24, 1175.91 examples/s]Map (num_proc=32):   1%|          | 4435/385620 [00:07<06:34, 965.30 examples/s] Map (num_proc=32):   1%|          | 4735/385620 [00:07<05:38, 1124.11 examples/s]Map (num_proc=32):   1%|▏         | 5048/385620 [00:07<04:39, 1359.31 examples/s]Map (num_proc=32):   1%|▏         | 5212/385620 [00:07<04:38, 1364.90 examples/s]Map (num_proc=32):   1%|▏         | 5452/385620 [00:08<04:17, 1474.83 examples/s]Map (num_proc=32):   1%|▏         | 5651/385620 [00:08<04:11, 1512.07 examples/s]Map (num_proc=32):   2%|▏         | 5816/385620 [00:08<04:50, 1306.88 examples/s]Map (num_proc=32):   2%|▏         | 5971/385620 [00:08<05:40, 1114.61 examples/s]Map (num_proc=32):   2%|▏         | 6146/385620 [00:08<05:24, 1170.77 examples/s]Map (num_proc=32):   2%|▏         | 6376/385620 [00:08<04:52, 1295.41 examples/s]Map (num_proc=32):   2%|▏         | 6611/385620 [00:08<04:21, 1450.50 examples/s]Map (num_proc=32):   2%|▏         | 6858/385620 [00:09<03:45, 1678.52 examples/s]Map (num_proc=32):   2%|▏         | 7046/385620 [00:09<03:43, 1691.67 examples/s]Map (num_proc=32):   2%|▏         | 7270/385620 [00:09<03:27, 1823.06 examples/s]Map (num_proc=32):   2%|▏         | 7485/385620 [00:09<05:00, 1259.57 examples/s]Map (num_proc=32):   2%|▏         | 7884/385620 [00:09<04:23, 1431.62 examples/s]Map (num_proc=32):   2%|▏         | 8276/385620 [00:10<04:05, 1537.18 examples/s]Map (num_proc=32):   2%|▏         | 8815/385620 [00:10<02:57, 2118.08 examples/s]Map (num_proc=32):   2%|▏         | 9084/385620 [00:10<03:34, 1759.03 examples/s]Map (num_proc=32):   2%|▏         | 9337/385620 [00:10<04:15, 1473.45 examples/s]Map (num_proc=32):   3%|▎         | 9745/385620 [00:10<03:57, 1585.50 examples/s]Map (num_proc=32):   3%|▎         | 10376/385620 [00:11<03:15, 1919.36 examples/s]Map (num_proc=32):   3%|▎         | 10749/385620 [00:11<02:51, 2188.72 examples/s]Map (num_proc=32):   3%|▎         | 11032/385620 [00:11<03:02, 2052.73 examples/s]Map (num_proc=32):   3%|▎         | 11282/385620 [00:11<03:04, 2030.18 examples/s]Map (num_proc=32):   3%|▎         | 11503/385620 [00:11<03:10, 1960.68 examples/s]Map (num_proc=32):   3%|▎         | 11706/385620 [00:11<03:31, 1768.93 examples/s]Map (num_proc=32):   3%|▎         | 11925/385620 [00:11<03:22, 1844.84 examples/s]Map (num_proc=32):   3%|▎         | 12132/385620 [00:12<03:17, 1895.42 examples/s]Map (num_proc=32):   3%|▎         | 12353/385620 [00:12<03:17, 1893.42 examples/s]Map (num_proc=32):   3%|▎         | 12599/385620 [00:12<03:08, 1981.93 examples/s]Map (num_proc=32):   3%|▎         | 12821/385620 [00:12<03:30, 1768.16 examples/s]Map (num_proc=32):   3%|▎         | 13028/385620 [00:12<03:26, 1805.51 examples/s]Map (num_proc=32):   3%|▎         | 13281/385620 [00:12<03:11, 1944.36 examples/s]Map (num_proc=32):   4%|▎         | 13516/385620 [00:13<06:19, 980.91 examples/s] Map (num_proc=32):   4%|▎         | 13959/385620 [00:13<05:20, 1158.19 examples/s]Map (num_proc=32):   4%|▍         | 14482/385620 [00:13<04:52, 1267.92 examples/s]Map (num_proc=32):   4%|▍         | 15279/385620 [00:14<03:58, 1552.40 examples/s]Map (num_proc=32):   4%|▍         | 15934/385620 [00:14<03:29, 1760.70 examples/s]Map (num_proc=32):   4%|▍         | 16471/385620 [00:14<03:25, 1797.71 examples/s]Map (num_proc=32):   4%|▍         | 17228/385620 [00:15<02:55, 2094.90 examples/s]Map (num_proc=32):   5%|▍         | 17827/385620 [00:15<02:23, 2567.51 examples/s]Map (num_proc=32):   5%|▍         | 18177/385620 [00:15<02:28, 2468.01 examples/s]Map (num_proc=32):   5%|▍         | 18499/385620 [00:15<02:27, 2494.23 examples/s]Map (num_proc=32):   5%|▍         | 18794/385620 [00:15<02:33, 2383.43 examples/s]Map (num_proc=32):   5%|▍         | 19129/385620 [00:15<02:22, 2568.34 examples/s]Map (num_proc=32):   5%|▌         | 19426/385620 [00:15<02:36, 2344.56 examples/s]Map (num_proc=32):   5%|▌         | 19781/385620 [00:15<02:33, 2384.11 examples/s]Map (num_proc=32):   5%|▌         | 20116/385620 [00:16<02:25, 2507.59 examples/s]Map (num_proc=32):   5%|▌         | 20406/385620 [00:16<02:29, 2449.81 examples/s]Map (num_proc=32):   5%|▌         | 20694/385620 [00:16<02:35, 2345.19 examples/s]Map (num_proc=32):   5%|▌         | 20984/385620 [00:16<02:28, 2454.31 examples/s]Map (num_proc=32):   6%|▌         | 21252/385620 [00:17<06:03, 1001.12 examples/s]Map (num_proc=32):   6%|▌         | 21742/385620 [00:17<07:06, 853.40 examples/s] Map (num_proc=32):   6%|▌         | 22362/385620 [00:18<05:40, 1065.53 examples/s]Map (num_proc=32):   6%|▌         | 23261/385620 [00:18<03:19, 1818.31 examples/s]Map (num_proc=32):   6%|▌         | 23652/385620 [00:18<04:06, 1469.77 examples/s]Map (num_proc=32):   6%|▋         | 24172/385620 [00:19<03:53, 1546.63 examples/s]Map (num_proc=32):   6%|▋         | 24860/385620 [00:19<03:39, 1642.93 examples/s]Map (num_proc=32):   7%|▋         | 25711/385620 [00:19<02:39, 2250.46 examples/s]Map (num_proc=32):   7%|▋         | 26056/385620 [00:19<02:47, 2150.62 examples/s]Map (num_proc=32):   7%|▋         | 26479/385620 [00:19<02:28, 2423.28 examples/s]Map (num_proc=32):   7%|▋         | 26813/385620 [00:20<02:51, 2094.54 examples/s]Map (num_proc=32):   7%|▋         | 27095/385620 [00:20<02:47, 2143.20 examples/s]Map (num_proc=32):   7%|▋         | 27389/385620 [00:20<02:36, 2288.92 examples/s]Map (num_proc=32):   7%|▋         | 27681/385620 [00:20<02:35, 2294.98 examples/s]Map (num_proc=32):   7%|▋         | 27941/385620 [00:20<02:32, 2353.01 examples/s]Map (num_proc=32):   7%|▋         | 28265/385620 [00:20<02:27, 2420.53 examples/s]Map (num_proc=32):   7%|▋         | 28542/385620 [00:20<02:29, 2394.70 examples/s]Map (num_proc=32):   7%|▋         | 28828/385620 [00:20<02:30, 2368.11 examples/s]Map (num_proc=32):   8%|▊         | 29110/385620 [00:21<02:24, 2475.45 examples/s]Map (num_proc=32):   8%|▊         | 29373/385620 [00:21<02:25, 2446.36 examples/s]Map (num_proc=32):   8%|▊         | 29678/385620 [00:21<02:16, 2607.06 examples/s]Map (num_proc=32):   8%|▊         | 29948/385620 [00:21<02:28, 2395.52 examples/s]Map (num_proc=32):   8%|▊         | 30253/385620 [00:21<02:18, 2567.19 examples/s]Map (num_proc=32):   8%|▊         | 30525/385620 [00:21<04:03, 1456.50 examples/s]Map (num_proc=32):   8%|▊         | 31166/385620 [00:22<04:22, 1351.92 examples/s]Map (num_proc=32):   8%|▊         | 31876/385620 [00:22<03:48, 1550.89 examples/s]Map (num_proc=32):   9%|▊         | 32915/385620 [00:22<02:21, 2488.23 examples/s]Map (num_proc=32):   9%|▊         | 33302/385620 [00:23<03:15, 1797.80 examples/s]Map (num_proc=32):   9%|▉         | 34153/385620 [00:23<03:23, 1730.35 examples/s]Map (num_proc=32):   9%|▉         | 35165/385620 [00:24<02:50, 2052.66 examples/s]Map (num_proc=32):   9%|▉         | 36258/385620 [00:24<02:33, 2275.44 examples/s]Map (num_proc=32):  10%|▉         | 36930/385620 [00:24<02:15, 2565.94 examples/s]Map (num_proc=32):  10%|▉         | 37461/385620 [00:24<02:01, 2871.54 examples/s]Map (num_proc=32):  10%|▉         | 37851/385620 [00:25<02:05, 2771.28 examples/s]Map (num_proc=32):  10%|▉         | 38223/385620 [00:25<02:07, 2722.60 examples/s]Map (num_proc=32):  10%|▉         | 38533/385620 [00:25<02:17, 2522.49 examples/s]Map (num_proc=32):  10%|█         | 38815/385620 [00:25<02:16, 2539.80 examples/s]Map (num_proc=32):  10%|█         | 39166/385620 [00:25<02:08, 2695.31 examples/s]Map (num_proc=32):  10%|█         | 39469/385620 [00:25<02:09, 2675.58 examples/s]Map (num_proc=32):  10%|█         | 39766/385620 [00:25<02:10, 2645.38 examples/s]Map (num_proc=32):  10%|█         | 40064/385620 [00:25<02:11, 2623.59 examples/s]Map (num_proc=32):  10%|█         | 40345/385620 [00:26<02:32, 2260.17 examples/s]Map (num_proc=32):  11%|█         | 40597/385620 [00:26<02:28, 2320.94 examples/s]Map (num_proc=32):  11%|█         | 40935/385620 [00:26<02:18, 2486.77 examples/s]Map (num_proc=32):  11%|█         | 41231/385620 [00:26<02:12, 2602.67 examples/s]Map (num_proc=32):  11%|█         | 41512/385620 [00:26<02:13, 2580.79 examples/s]Map (num_proc=32):  11%|█         | 41785/385620 [00:26<02:17, 2509.06 examples/s]Map (num_proc=32):  11%|█         | 42048/385620 [00:27<05:13, 1096.17 examples/s]Map (num_proc=32):  11%|█         | 42970/385620 [00:27<03:26, 1657.95 examples/s]Map (num_proc=32):  11%|█▏        | 43791/385620 [00:27<03:12, 1776.81 examples/s]