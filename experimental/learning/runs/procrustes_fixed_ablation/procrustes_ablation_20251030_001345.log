/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
================================================================================
PROCRUSTES FIXED ABLATION - STARTING
================================================================================
Python version: 3.10.14 | packaged by conda-forge | (main, Mar 20 2024, 12:45:18) [GCC 12.3.0]
PyTorch version: 2.5.1+cu121
CUDA available: True
CUDA device count: 1
CUDA current device: 0
Script: /projects/m000066/sujinesh/LatentWire/experimental/learning/procrustes_fixed_ablation.py
================================================================================

================================================================================
PROCRUSTES FIXED ABLATION - Layer Selection Study
================================================================================
Layers to test: [0, 8, 16, 24, 32]
Test prompts: 5
Device: cuda:0

Loading models...
  Llama: meta-llama/Llama-3.1-8B
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 2063.36it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:19<00:57, 19.10s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:37<00:37, 18.58s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:55<00:18, 18.39s/it]Loading checkpoint shards: 100%|██████████| 4/4 [01:00<00:00, 13.02s/it]Loading checkpoint shards: 100%|██████████| 4/4 [01:00<00:00, 15.06s/it]
  ✓ Llama loaded
  Mistral: mistralai/Mistral-7B-v0.3
Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 2461.93it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:18<00:36, 18.02s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:35<00:17, 17.75s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:52<00:00, 17.29s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:52<00:00, 17.45s/it]
Traceback (most recent call last):
  File "/projects/m000066/sujinesh/LatentWire/experimental/learning/procrustes_fixed_ablation.py", line 549, in <module>
    results = run_layer_ablation()
  File "/projects/m000066/sujinesh/LatentWire/experimental/learning/procrustes_fixed_ablation.py", line 395, in run_layer_ablation
    calibration_texts = load_calibration_texts(CALIBRATION_SIZE)
  File "/projects/m000066/sujinesh/LatentWire/experimental/learning/procrustes_fixed_ablation.py", line 326, in load_calibration_texts
    dataset = load_dataset("rajpurkar/squad", split="train", trust_remote_code=True)
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/load.py", line 2132, in load_dataset
    builder_instance = load_dataset_builder(
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/load.py", line 1853, in load_dataset_builder
    dataset_module = dataset_module_factory(
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/load.py", line 1729, in dataset_module_factory
    raise e1 from None
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/load.py", line 1694, in dataset_module_factory
    ).get_module()
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/load.py", line 1045, in get_module
    {
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/load.py", line 1046, in <dictcomp>
    config_name: DatasetInfo.from_dict(exported_dataset_infos[config_name])
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/info.py", line 284, in from_dict
    return cls(**{k: v for k, v in dataset_info_dict.items() if k in field_names})
  File "<string>", line 20, in __init__
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/info.py", line 170, in __post_init__
    self.features = Features.from_dict(self.features)
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/features/features.py", line 1832, in from_dict
    obj = generate_from_dict(dic)
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/features/features.py", line 1458, in generate_from_dict
    return {key: generate_from_dict(value) for key, value in obj.items()}
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/features/features.py", line 1458, in <dictcomp>
    return {key: generate_from_dict(value) for key, value in obj.items()}
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/features/features.py", line 1458, in generate_from_dict
    return {key: generate_from_dict(value) for key, value in obj.items()}
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/features/features.py", line 1458, in <dictcomp>
    return {key: generate_from_dict(value) for key, value in obj.items()}
  File "/users/sujinesh/.local/lib/python3.10/site-packages/datasets/features/features.py", line 1473, in generate_from_dict
    field_names = {f.name for f in fields(class_type)}
  File "/marlowe/apps/Mambaforge/24.3.0-0/lib/python3.10/dataclasses.py", line 1198, in fields
    raise TypeError('must be called with a dataclass type or instance') from None
TypeError: must be called with a dataclass type or instance
  ✓ Mistral loaded

Loading 100 calibration texts from SQuAD...
  Checking cache at: /projects/m000066/sujinesh/.cache/huggingface/rajpurkar___squad
  Cache exists: False
  Cache directory does not exist - proceeding with fresh download

================================================================================
EXPERIMENT FAILED WITH ERROR
================================================================================
Error type: TypeError
Error message: must be called with a dataclass type or instance

Full traceback:
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

================================================================================
