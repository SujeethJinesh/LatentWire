W1202 17:42:57.384000 1730760 torch/distributed/run.py:793] 
W1202 17:42:57.384000 1730760 torch/distributed/run.py:793] *****************************************
W1202 17:42:57.384000 1730760 torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1202 17:42:57.384000 1730760 torch/distributed/run.py:793] *****************************************
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[W1202 17:43:02.924595114 CUDAAllocatorConfig.h:28] Warning: expandable_segments not supported on this platform (function operator())
[W1202 17:43:02.951015175 CUDAAllocatorConfig.h:28] Warning: expandable_segments not supported on this platform (function operator())
======================================================================
Phase 15: VQ-Telepathy (Discrete Bottleneck)
======================================================================

THE FIX FOR MANIFOLD MISMATCH:
  - Regression (V7): Blurry averages
  - Diffusion Global (V12): Lost details
  - Diffusion Cross-Attn (V13-14): Failed to converge

VQ SOLUTION:
  - Discrete bottleneck prevents blur/drift
  - 4096 codebook entries for rich concepts
  - 1-step inference (no diffusion iteration)

Training: 3000 steps, batch=2
VQ weight: 1.0
======================================================================
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 3597.17it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 7463.17it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:06,  2.10s/it]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:07,  2.53s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.12s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.22s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.15s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.20s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.53s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.57s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.75s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.83s/it]
Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 1838.80it/s]
Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 385.12it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:03,  1.87s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:03,  1.95s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:04<00:02,  2.03s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:04<00:02,  2.04s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.02s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.02s/it]
Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.05s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.03s/it]
Target embedding RMS: 0.0027
[PerceiverResampler] 128 latents, 4 layers, 8 heads
[PerceiverResampler] 128 latents, 4 layers, 8 heads
[LatentBridgeV15] VQ-Telepathy Bridge
  - src_dim: 4096
  - tgt_dim: 4096
  - num_latents: 128
  - codebook_size: 4096
  - target_rms: 0.0027
[LatentBridgeV15] VQ-Telepathy Bridge
  - src_dim: 4096
  - tgt_dim: 4096
  - num_latents: 128
  - codebook_size: 4096
  - target_rms: 0.0027

Training on 3737 samples
Starting training loop...
V15 VQ-Telepathy:   0%|                                                    | 0/3000 [00:00<?, ?it/s]V15 VQ-Telepathy:   0%|               | 0/3000 [00:03<?, ?it/s, tot=9.19, lm=2.19, vq=7.004, ppl=40]V15 VQ-Telepathy:   0%|     | 1/3000 [00:03<2:34:20,  3.09s/it, tot=9.19, lm=2.19, vq=7.004, ppl=40]V15 VQ-Telepathy:   0%|     | 1/3000 [00:04<2:34:20,  3.09s/it, tot=9.12, lm=2.09, vq=7.030, ppl=38]V15 VQ-Telepathy:   0%|     | 2/3000 [00:04<1:31:59,  1.84s/it, tot=9.12, lm=2.09, vq=7.030, ppl=38]V15 VQ-Telepathy:   0%|     | 2/3000 [00:05<1:31:59,  1.84s/it, tot=9.74, lm=2.57, vq=7.173, ppl=40]V15 VQ-Telepathy:   0%|     | 3/3000 [00:05<1:13:03,  1.46s/it, tot=9.74, lm=2.57, vq=7.173, ppl=40]V15 VQ-Telepathy:   0%|     | 3/3000 [00:06<1:13:03,  1.46s/it, tot=8.96, lm=2.26, vq=6.701, ppl=39]V15 VQ-Telepathy:   0%|     | 4/3000 [00:06<1:03:41,  1.28s/it, tot=8.96, lm=2.26, vq=6.701, ppl=39]V15 VQ-Telepathy:   0%|     | 4/3000 [00:06<1:03:41,  1.28s/it, tot=9.00, lm=1.95, vq=7.053, ppl=39]V15 VQ-Telepathy:   0%|       | 5/3000 [00:06<56:08,  1.12s/it, tot=9.00, lm=1.95, vq=7.053, ppl=39]V15 VQ-Telepathy:   0%|      | 5/3000 [00:07<56:08,  1.12s/it, tot=10.20, lm=2.50, vq=7.703, ppl=33]V15 VQ-Telepathy:   0%|      | 6/3000 [00:07<54:45,  1.10s/it, tot=10.20, lm=2.50, vq=7.703, ppl=33]V15 VQ-Telepathy:   0%|      | 6/3000 [00:08<54:45,  1.10s/it, tot=10.51, lm=2.01, vq=8.504, ppl=22]V15 VQ-Telepathy:   0%|      | 7/3000 [00:08<50:59,  1.02s/it, tot=10.51, lm=2.01, vq=8.504, ppl=22]V15 VQ-Telepathy:   0%|      | 7/3000 [00:09<50:59,  1.02s/it, tot=11.45, lm=2.31, vq=9.145, ppl=16]V15 VQ-Telepathy:   0%|      | 8/3000 [00:09<48:33,  1.03it/s, tot=11.45, lm=2.31, vq=9.145, ppl=16]V15 VQ-Telepathy:   0%|     | 8/3000 [00:10<48:33,  1.03it/s, tot=12.40, lm=2.25, vq=10.145, ppl=11]V15 VQ-Telepathy:   0%|     | 9/3000 [00:10<50:22,  1.01s/it, tot=12.40, lm=2.25, vq=10.145, ppl=11]V15 VQ-Telepathy:   0%|      | 9/3000 [00:11<50:22,  1.01s/it, tot=12.80, lm=2.28, vq=10.516, ppl=8]V15 VQ-Telepathy:   0%|     | 10/3000 [00:11<48:14,  1.03it/s, tot=12.80, lm=2.28, vq=10.516, ppl=8]V15 VQ-Telepathy:   0%|     | 10/3000 [00:12<48:14,  1.03it/s, tot=13.89, lm=2.20, vq=11.681, ppl=7]V15 VQ-Telepathy:   0%|     | 11/3000 [00:12<46:45,  1.07it/s, tot=13.89, lm=2.20, vq=11.681, ppl=7]V15 VQ-Telepathy:   0%|     | 11/3000 [00:13<46:45,  1.07it/s, tot=14.17, lm=2.19, vq=11.977, ppl=6]V15 VQ-Telepathy:   0%|     | 12/3000 [00:13<48:37,  1.02it/s, tot=14.17, lm=2.19, vq=11.977, ppl=6]V15 VQ-Telepathy:   0%|     | 12/3000 [00:14<48:37,  1.02it/s, tot=14.85, lm=2.14, vq=12.713, ppl=7]V15 VQ-Telepathy:   0%|     | 13/3000 [00:14<46:58,  1.06it/s, tot=14.85, lm=2.14, vq=12.713, ppl=7]V15 VQ-Telepathy:   0%|     | 13/3000 [00:15<46:58,  1.06it/s, tot=15.74, lm=2.24, vq=13.499, ppl=7]V15 VQ-Telepathy:   0%|     | 14/3000 [00:15<46:03,  1.08it/s, tot=15.74, lm=2.24, vq=13.499, ppl=7]V15 VQ-Telepathy:   0%|     | 14/3000 [00:16<46:03,  1.08it/s, tot=17.34, lm=2.31, vq=15.038, ppl=5]V15 VQ-Telepathy:   0%|     | 15/3000 [00:16<48:05,  1.03it/s, tot=17.34, lm=2.31, vq=15.038, ppl=5]V15 VQ-Telepathy:   0%|     | 15/3000 [00:17<48:05,  1.03it/s, tot=18.77, lm=2.21, vq=16.560, ppl=3]V15 VQ-Telepathy:   1%|     | 16/3000 [00:17<46:53,  1.06it/s, tot=18.77, lm=2.21, vq=16.560, ppl=3]V15 VQ-Telepathy:   1%|     | 16/3000 [00:18<46:53,  1.06it/s, tot=19.82, lm=1.67, vq=18.150, ppl=2]V15 VQ-Telepathy:   1%|     | 17/3000 [00:18<46:44,  1.06it/s, tot=19.82, lm=1.67, vq=18.150, ppl=2]V15 VQ-Telepathy:   1%|     | 17/3000 [00:19<46:44,  1.06it/s, tot=22.98, lm=2.47, vq=20.511, ppl=1]V15 VQ-Telepathy:   1%|     | 18/3000 [00:19<48:27,  1.03it/s, tot=22.98, lm=2.47, vq=20.511, ppl=1]V15 VQ-Telepathy:   1%|     | 18/3000 [00:20<48:27,  1.03it/s, tot=24.95, lm=2.26, vq=22.690, ppl=1]V15 VQ-Telepathy:   1%|     | 19/3000 [00:20<46:23,  1.07it/s, tot=24.95, lm=2.26, vq=22.690, ppl=1]V15 VQ-Telepathy:   1%|     | 19/3000 [00:21<46:23,  1.07it/s, tot=27.76, lm=2.63, vq=25.124, ppl=1]V15 VQ-Telepathy:   1%|     | 20/3000 [00:21<46:59,  1.06it/s, tot=27.76, lm=2.63, vq=25.124, ppl=1]V15 VQ-Telepathy:   1%|     | 20/3000 [00:22<46:59,  1.06it/s, tot=30.84, lm=2.46, vq=28.380, ppl=1]V15 VQ-Telepathy:   1%|     | 21/3000 [00:22<49:04,  1.01it/s, tot=30.84, lm=2.46, vq=28.380, ppl=1]V15 VQ-Telepathy:   1%|     | 21/3000 [00:23<49:04,  1.01it/s, tot=35.79, lm=2.07, vq=33.728, ppl=1]V15 VQ-Telepathy:   1%|     | 22/3000 [00:23<46:33,  1.07it/s, tot=35.79, lm=2.07, vq=33.728, ppl=1]V15 VQ-Telepathy:   1%|     | 22/3000 [00:23<46:33,  1.07it/s, tot=41.49, lm=2.36, vq=39.130, ppl=1]V15 VQ-Telepathy:   1%|     | 23/3000 [00:23<45:30,  1.09it/s, tot=41.49, lm=2.36, vq=39.130, ppl=1]V15 VQ-Telepathy:   1%|     | 23/3000 [00:24<45:30,  1.09it/s, tot=49.11, lm=2.62, vq=46.488, ppl=1]V15 VQ-Telepathy:   1%|     | 24/3000 [00:24<47:21,  1.05it/s, tot=49.11, lm=2.62, vq=46.488, ppl=1]V15 VQ-Telepathy:   1%|     | 24/3000 [00:25<47:21,  1.05it/s, tot=56.10, lm=2.02, vq=54.082, ppl=1]V15 VQ-Telepathy:   1%|     | 25/3000 [00:25<45:56,  1.08it/s, tot=56.10, lm=2.02, vq=54.082, ppl=1]V15 VQ-Telepathy:   1%|     | 25/3000 [00:26<45:56,  1.08it/s, tot=65.85, lm=2.34, vq=63.513, ppl=1]V15 VQ-Telepathy:   1%|     | 26/3000 [00:26<45:02,  1.10it/s, tot=65.85, lm=2.34, vq=63.513, ppl=1]V15 VQ-Telepathy:   1%|     | 26/3000 [00:27<45:02,  1.10it/s, tot=75.53, lm=2.61, vq=72.917, ppl=1]V15 VQ-Telepathy:   1%|     | 27/3000 [00:27<46:34,  1.06it/s, tot=75.53, lm=2.61, vq=72.917, ppl=1]V15 VQ-Telepathy:   1%|     | 27/3000 [00:28<46:34,  1.06it/s, tot=84.41, lm=2.31, vq=82.106, ppl=1]V15 VQ-Telepathy:   1%|     | 28/3000 [00:28<45:31,  1.09it/s, tot=84.41, lm=2.31, vq=82.106, ppl=1]V15 VQ-Telepathy:   1%|     | 28/3000 [00:29<45:31,  1.09it/s, tot=95.28, lm=2.15, vq=93.130, ppl=1]V15 VQ-Telepathy:   1%|     | 29/3000 [00:29<44:19,  1.12it/s, tot=95.28, lm=2.15, vq=93.130, ppl=1]V15 VQ-Telepathy:   1%|   | 29/3000 [00:30<44:19,  1.12it/s, tot=111.82, lm=2.72, vq=109.099, ppl=1]V15 VQ-Telepathy:   1%|   | 30/3000 [00:30<45:15,  1.09it/s, tot=111.82, lm=2.72, vq=109.099, ppl=1]V15 VQ-Telepathy:   1%|   | 30/3000 [00:31<45:15,  1.09it/s, tot=132.50, lm=2.61, vq=129.894, ppl=1]V15 VQ-Telepathy:   1%|   | 31/3000 [00:31<45:57,  1.08it/s, tot=132.50, lm=2.61, vq=129.894, ppl=1]V15 VQ-Telepathy:   1%|   | 31/3000 [00:32<45:57,  1.08it/s, tot=161.44, lm=2.45, vq=158.989, ppl=1]V15 VQ-Telepathy:   1%|   | 32/3000 [00:32<45:03,  1.10it/s, tot=161.44, lm=2.45, vq=158.989, ppl=1]V15 VQ-Telepathy:   1%|   | 32/3000 [00:33<45:03,  1.10it/s, tot=190.64, lm=2.49, vq=188.150, ppl=1]V15 VQ-Telepathy:   1%|   | 33/3000 [00:33<46:26,  1.06it/s, tot=190.64, lm=2.49, vq=188.150, ppl=1]V15 VQ-Telepathy:   1%|   | 33/3000 [00:34<46:26,  1.06it/s, tot=234.84, lm=2.04, vq=232.803, ppl=1]V15 VQ-Telepathy:   1%|   | 34/3000 [00:34<47:20,  1.04it/s, tot=234.84, lm=2.04, vq=232.803, ppl=1]V15 VQ-Telepathy:   1%|   | 34/3000 [00:35<47:20,  1.04it/s, tot=299.22, lm=2.41, vq=296.816, ppl=1]V15 VQ-Telepathy:   1%|   | 35/3000 [00:35<45:48,  1.08it/s, tot=299.22, lm=2.41, vq=296.816, ppl=1]V15 VQ-Telepathy:   1%|   | 35/3000 [00:36<45:48,  1.08it/s, tot=380.47, lm=2.37, vq=378.103, ppl=1]V15 VQ-Telepathy:   1%|   | 36/3000 [00:36<47:31,  1.04it/s, tot=380.47, lm=2.37, vq=378.103, ppl=1]V15 VQ-Telepathy:   1%|   | 36/3000 [00:36<47:31,  1.04it/s, tot=479.39, lm=2.24, vq=477.144, ppl=1]V15 VQ-Telepathy:   1%|   | 37/3000 [00:36<46:17,  1.07it/s, tot=479.39, lm=2.24, vq=477.144, ppl=1]V15 VQ-Telepathy:   1%|   | 37/3000 [00:37<46:17,  1.07it/s, tot=615.74, lm=2.00, vq=613.745, ppl=1]V15 VQ-Telepathy:   1%|   | 38/3000 [00:37<46:03,  1.07it/s, tot=615.74, lm=2.00, vq=613.745, ppl=1]V15 VQ-Telepathy:   1%|   | 38/3000 [00:38<46:03,  1.07it/s, tot=783.54, lm=2.10, vq=781.438, ppl=1]V15 VQ-Telepathy:   1%|   | 39/3000 [00:38<46:24,  1.06it/s, tot=783.54, lm=2.10, vq=781.438, ppl=1]V15 VQ-Telepathy:   1%| | 39/3000 [00:39<46:24,  1.06it/s, tot=1006.46, lm=2.45, vq=1004.019, ppl=1]V15 VQ-Telepathy:   1%| | 40/3000 [00:39<45:42,  1.08it/s, tot=1006.46, lm=2.45, vq=1004.019, ppl=1]V15 VQ-Telepathy:   1%| | 40/3000 [00:40<45:42,  1.08it/s, tot=1235.46, lm=2.70, vq=1232.760, ppl=1]V15 VQ-Telepathy:   1%| | 41/3000 [00:40<44:07,  1.12it/s, tot=1235.46, lm=2.70, vq=1232.760, ppl=1]V15 VQ-Telepathy:   1%| | 41/3000 [00:41<44:07,  1.12it/s, tot=1488.12, lm=2.50, vq=1485.622, ppl=1]V15 VQ-Telepathy:   1%| | 42/3000 [00:41<43:48,  1.13it/s, tot=1488.12, lm=2.50, vq=1485.622, ppl=1]V15 VQ-Telepathy:   1%| | 42/3000 [00:42<43:48,  1.13it/s, tot=1770.67, lm=2.70, vq=1767.979, ppl=1]V15 VQ-Telepathy:   1%| | 43/3000 [00:42<45:24,  1.09it/s, tot=1770.67, lm=2.70, vq=1767.979, ppl=1]V15 VQ-Telepathy:   1%| | 43/3000 [00:43<45:24,  1.09it/s, tot=2052.29, lm=2.09, vq=2050.198, ppl=1]V15 VQ-Telepathy:   1%| | 44/3000 [00:43<43:44,  1.13it/s, tot=2052.29, lm=2.09, vq=2050.198, ppl=1]V15 VQ-Telepathy:   1%| | 44/3000 [00:44<43:44,  1.13it/s, tot=2354.42, lm=2.56, vq=2351.862, ppl=1]V15 VQ-Telepathy:   2%| | 45/3000 [00:44<43:25,  1.13it/s, tot=2354.42, lm=2.56, vq=2351.862, ppl=1]V15 VQ-Telepathy:   2%| | 45/3000 [00:45<43:25,  1.13it/s, tot=2794.72, lm=2.67, vq=2792.049, ppl=1]V15 VQ-Telepathy:   2%| | 46/3000 [00:45<46:15,  1.06it/s, tot=2794.72, lm=2.67, vq=2792.049, ppl=1]V15 VQ-Telepathy:   2%| | 46/3000 [00:45<46:15,  1.06it/s, tot=3162.50, lm=2.11, vq=3160.393, ppl=1]V15 VQ-Telepathy:   2%| | 47/3000 [00:45<44:29,  1.11it/s, tot=3162.50, lm=2.11, vq=3160.393, ppl=1]V15 VQ-Telepathy:   2%| | 47/3000 [00:46<44:29,  1.11it/s, tot=3550.79, lm=2.06, vq=3548.738, ppl=1]V15 VQ-Telepathy:   2%| | 48/3000 [00:46<44:00,  1.12it/s, tot=3550.79, lm=2.06, vq=3548.738, ppl=1]V15 VQ-Telepathy:   2%|▏          | 48/3000 [00:47<44:00,  1.12it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 49/3000 [00:47<46:28,  1.06it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 49/3000 [00:48<46:28,  1.06it/s, tot=nan, lm=nan, vq=nan, ppl=1]
[Step 50/3000]
  Total: nan
  LM Loss: nan
  VQ Loss: nan
  Perplexity: 7.2 (codebook usage)
  LR: 1.00e-04
V15 VQ-Telepathy:   2%|▏          | 50/3000 [00:48<45:02,  1.09it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 50/3000 [00:49<45:02,  1.09it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 51/3000 [00:49<44:32,  1.10it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 51/3000 [00:50<44:32,  1.10it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 52/3000 [00:50<47:36,  1.03it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 52/3000 [00:51<47:36,  1.03it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 53/3000 [00:51<46:31,  1.06it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 53/3000 [00:52<46:31,  1.06it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 54/3000 [00:52<44:54,  1.09it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 54/3000 [00:53<44:54,  1.09it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 55/3000 [00:53<46:48,  1.05it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 55/3000 [00:54<46:48,  1.05it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 56/3000 [00:54<44:31,  1.10it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 56/3000 [00:55<44:31,  1.10it/s, tot=nan, lm=nan, vq=nan, ppl=1]V15 VQ-Telepathy:   2%|▏          | 57/3000 [00:55<43:55,  1.12it/s, tot=nan, lm=nan, vq=nan, ppl=1]