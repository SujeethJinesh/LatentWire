Starting GPU monitoring â†’ runs/smoke/gpu_monitor.log

>>> Combination 1: m64_dz256_rl2_rh4
    RUN_TAG=smoke
    EPOCHS_STAGEA=4 | EPOCHS_STAGEB=8
    WARMUP_TEXT_LATENT_EPOCHS_STAGEA=2.0 | WARMUP_TEXT_LATENT_EPOCHS_STAGEB=1.5

=== CUDA preflight ===
torch: 2.4.0+cu121 cuda: 12.1 available: True
CUDA_VISIBLE_DEVICES: 0,1,2,3
PYTORCH_CUDA_ALLOC_CONF: expandable_segments:True

=== Stage A: Llama latent fit ===

/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[Optimization] Enabled FlashAttention-2 and memory-efficient kernels
[Optimization] Enabled TF32 for matmul and cuDNN
Loading dataset subset...
Loading SQuAD subset...
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:00<00:00, 3426.72it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:01<00:04,  1.34s/it]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:02<00:02,  1.22s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:03<00:01,  1.19s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:03<00:00,  1.20it/s]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:03<00:00,  1.02it/s]
[meta-llama/Meta-Llama-3.1-8B-Instruct] hf_device_map: {'model.embed_tokens': 0, 'model.rotary_emb': 0, 'model.layers.0': 0, 'model.layers.1': 0, 'model.layers.2': 0, 'model.layers.3': 0, 'model.layers.4': 0, 'model.layers.5': 0, 'model.layers.6': 0, 'model.layers.7': 0, 'model.layers.8': 1, 'model.layers.9': 1, 'model.layers.10': 1, 'model.layers.11': 1, 'model.layers.12': 1, 'model.layers.13': 1, 'model.layers.14': 1, 'model.layers.15': 1, 'model.layers.16': 2, 'model.layers.17': 2, 'model.layers.18': 2, 'model.layers.19': 2, 'model.layers.20': 2, 'model.layers.21': 2, 'model.layers.22': 2, 'model.layers.23': 2, 'model.layers.24': 3, 'model.layers.25': 3, 'model.layers.26': 3, 'model.layers.27': 3, 'model.layers.28': 3, 'model.layers.29': 3, 'model.layers.30': 3, 'model.layers.31': 3, 'model.norm': 3, 'lm_head': 3}
[meta-llama/Meta-Llama-3.1-8B-Instruct] Initializing 3 latent adapters at layers (5, 10, 15)
[meta-llama/Meta-Llama-3.1-8B-Instruct] Latent adapters: 459,399,171 trainable parameters

ðŸ”§ Applying LoRA (r=8, alpha=8)...
   Llama BEFORE LoRA: 0 trainable / 8,030,261,248 total
trainable params: 6,815,744 || all params: 8,037,076,992 || trainable%: 0.0848
   Llama AFTER LoRA:  6,815,744 trainable / 8,037,076,992 total
   âœ“ Added 6,815,744 LoRA parameters to Llama
Llama hidden size: 4096
[DeviceMap] Llama: {'model.embed_tokens': 0, 'model.rotary_emb': 0, 'model.layers.0': 0, 'model.layers.1': 0, 'model.layers.2': 0, 'model.layers.3': 0, 'model.layers.4': 0, 'model.layers.5': 0, 'model.layers.6': 0, 'model.layers.7': 0, 'model.layers.8': 1, 'model.layers.9': 1, 'model.layers.10': 1, 'model.layers.11': 1, 'model.layers.12': 1, 'model.layers.13': 1, 'model.layers.14': 1, 'model.layers.15': 1, 'model.layers.16': 2, 'model.layers.17': 2, 'model.layers.18': 2, 'model.layers.19': 2, 'model.layers.20': 2, 'model.layers.21': 2, 'model.layers.22': 2, 'model.layers.23': 2, 'model.layers.24': 3, 'model.layers.25': 3, 'model.layers.26': 3, 'model.layers.27': 3, 'model.layers.28': 3, 'model.layers.29': 3, 'model.layers.30': 3, 'model.layers.31': 3, 'model.norm': 3, 'lm_head': 3}
[After Model Loading] [GPU Memory] GPU0:5.5GB(6%), GPU1:3.5GB(4%), GPU2:3.5GB(4%), GPU3:4.5GB(5%) | Total: 17.0GB allocated, 17.1GB reserved, 323.1GB free, Peak: 17.0GB
[INFO] llama anchor tokens: 3
[Optimization] Compiled encoder with torch.compile
[Optimization] Compiled 1 adapters with torch.compile
[Optimization] Compiled 1 deep prefix generators
[Optimization] Compiled latent refiner
[Optimization] Using fused AdamW optimizer
[INFO] LR scheduler: CosineAnnealingLR (T_max=120, eta_min=1.00e-06)
âš ï¸  No valid checkpoint found to resume; starting fresh.
[warmup] alternating text/latent for first 60 steps
Epoch 1/4
[Epoch 1 Start] [GPU Memory] GPU0:6.8GB(11%), GPU1:3.5GB(4%), GPU2:3.5GB(4%), GPU3:4.5GB(5%) | Total: 18.3GB allocated, 21.0GB reserved, 319.1GB free, Peak: 21.0GB
[warmup] step=0 mode=text (warm-up)
    [Memory after encoder] 18.4GB allocated
We detected that you are passing `past_key_values` as a tuple of tuples. This is deprecated and will be removed in v4.47. Please convert your cache or use an appropriate `Cache` class (https://huggingface.co/docs/transformers/kv_cache#legacy-cache-format)
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)
  step  1/30 | (warm-up text) | align=0.0002 | text_tf=16.2679 | latent_scale=0.00
W1008 19:27:58.662687 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:27:58.663002 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:27:58.668680 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:27:58.668853 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:27:58.668940 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] d1 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.048184 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.048334 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.059451 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.059594 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.059658 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.150173 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.150322 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.150388 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.595322 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.595489 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:27:59.595584 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [6/0] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.325398 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.325835 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.337724 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.337924 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.338020 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] d1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.618760 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.618913 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.626124 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.626290 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.626377 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.709315 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.709460 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.716218 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.716384 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.716468 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.773973 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.774156 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.781571 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.781737 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.840818 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.840962 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.846515 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.846679 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.908842 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.908983 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.909049 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.985798 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.985974 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:00.986064 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.035337 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.035477 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.089563 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.089702 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.333964 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.334171 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.340897 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.341089 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.341176 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.435945 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.436168 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.441956 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.442174 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.516655 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.516875 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.516967 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.587508 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:28:01.587727 23443105904192 torch/fx/experimental/symbolic_shapes.py:4449] [5/0] x0 is not in var_ranges, defaulting to unknown range.
    [Memory after backward] 20.4GB allocated, peak 175.3GB
[warmup] step=1 mode=latent (warm-up)
W1008 19:34:39.815338 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:39.815688 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:39.826612 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:39.826787 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:39.826857 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] d1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.172945 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.173163 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.173232 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.191439 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.191596 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.191814 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.445585 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.445809 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.445998 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.459834 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.459994 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.460153 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.592784 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.592974 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.601660 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.601905 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.669042 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.669186 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.674838 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.675004 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.719169 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.719317 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.730069 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.730204 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.730272 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.787515 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.787657 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.795475 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.795643 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.795725 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.837185 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.837331 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.865639 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:40.865779 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.153076 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.153286 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.153462 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.170418 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.170579 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.170760 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.386135 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.386337 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.391920 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.392097 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.464161 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.464321 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.472678 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.472855 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.472944 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.545214 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:34:41.545363 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/1] x0 is not in var_ranges, defaulting to unknown range.
    [Memory after encoder] 18.6GB allocated
    [Memory after backward] 19.4GB allocated, peak 175.3GB
[warmup] step=2 mode=text (warm-up)
W1008 19:45:50.904362 23456234751808 torch/_dynamo/convert_frame.py:762] [2/8] torch._dynamo hit config.cache_size_limit (8)
W1008 19:45:50.904362 23456234751808 torch/_dynamo/convert_frame.py:762] [2/8]    function: 'as_tensor' (/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/tokenization_utils_base.py:734)
W1008 19:45:50.904362 23456234751808 torch/_dynamo/convert_frame.py:762] [2/8]    last reason: len(L['value'][0]) == 374                                   
W1008 19:45:50.904362 23456234751808 torch/_dynamo/convert_frame.py:762] [2/8] To log all recompilation reasons, use TORCH_LOGS="recompiles".
W1008 19:45:50.904362 23456234751808 torch/_dynamo/convert_frame.py:762] [2/8] To diagnose recompilation issues, see https://pytorch.org/docs/main/torch.compiler_troubleshooting.html.
W1008 19:45:55.049067 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.049288 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.060415 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] d2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.060609 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] d0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.060696 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] d1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.395939 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.396089 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.396155 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.415899 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.416039 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.416274 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.681307 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.681460 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.681611 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.696597 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.696737 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.696900 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.809348 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.809493 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.818688 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.818945 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.854231 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.854370 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.860861 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.861030 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.904424 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.904568 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.915370 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.915506 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.915573 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.974164 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.974317 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.982767 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.982938 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:55.983024 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.023267 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.023414 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] q0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.053955 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.054109 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] z0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.349685 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.349916 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.350085 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.370048 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.370218 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.370430 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.569203 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.569366 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.575579 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.575750 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.649714 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.649861 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.658202 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.658373 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] r2 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.658463 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x0 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.732481 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x1 is not in var_ranges, defaulting to unknown range.
W1008 19:45:56.732626 23456234751808 torch/fx/experimental/symbolic_shapes.py:4449] [5/2] x0 is not in var_ranges, defaulting to unknown range.
    [Memory after encoder] 18.7GB allocated
  step  3/30 | (warm-up text) | align=0.0002 | text_tf=15.9419 | latent_scale=0.02
    [Memory after backward] 19.5GB allocated, peak 227.9GB
[warmup] step=3 mode=latent (warm-up)
[warmup] step=4 mode=text (warm-up)
  step  5/30 | (warm-up text) | align=0.0002 | text_tf=14.8455 | latent_scale=0.03
[warmup] step=5 mode=latent (warm-up)
[warmup] step=6 mode=text (warm-up)
  step  7/30 | (warm-up text) | align=0.0002 | text_tf=12.8386 | latent_scale=0.05
[warmup] step=7 mode=latent (warm-up)
[warmup] step=8 mode=text (warm-up)
  step  9/30 | (warm-up text) | align=0.0002 | text_tf=14.8582 | latent_scale=0.07
[warmup] step=9 mode=latent (warm-up)
  step  10/30 | grad_norm=53.25 | sec/step~9.72 | lr=5.00e-05 | keep=0.70 | K=8 | first_w=0.27 | llama(L): tf=14.1875 first=13.6200 kCE=14.1016 KD=5.5318 acc=0.000 state=13.7694 ent=9.199 align=0.0000 latA=0.4990 latP=0.2508 | scale_pen(llama)=1.4211e-14 | K=8 tau=4.00 | stats=[llama: rms_raw~1.0000 rms_cal~0.0106 embed_rms~0.01058]
  [Step 10] [GPU Memory] GPU0:10.1GB(77%), GPU1:3.5GB(61%), GPU2:3.5GB(61%), GPU3:4.6GB(77%) | Total: 21.8GB allocated, 235.3GB reserved, 104.8GB free, Peak: 227.9GB
  step  11/30 | (warm-up text) | align=nan | text_tf=15.3723 | latent_scale=0.08
NaN/Inf loss; skipping step
Traceback (most recent call last):
  File "/projects/m000066/sujinesh/LatentWire/latentwire/train.py", line 3034, in <module>
    main()
  File "/projects/m000066/sujinesh/LatentWire/latentwire/train.py", line 2037, in main
    loss_kd_raw = kd_first_k_prefix_vs_text(
  File "/projects/m000066/sujinesh/LatentWire/latentwire/losses.py", line 257, in kd_first_k_prefix_vs_text
    student_logits = student_llm.model(
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/peft/peft_model.py", line 1850, in forward
    return self.base_model(
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/peft/tuners/tuners_utils.py", line 222, in forward
    return self.model.forward(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/accelerate/hooks.py", line 175, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 1189, in forward
    outputs = self.model(
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 1000, in forward
    layer_outputs = decoder_layer(
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/accelerate/hooks.py", line 175, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 744, in forward
    hidden_states = self.post_attention_layernorm(hidden_states)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/accelerate/hooks.py", line 175, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 125, in forward
    variance = hidden_states.pow(2).mean(-1, keepdim=True)
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 20.00 MiB. GPU 0 has a total capacity of 79.19 GiB of which 14.00 MiB is free. Including non-PyTorch memory, this process has 79.17 GiB memory in use. Of the allocated memory 78.15 GiB is allocated by PyTorch, with 5.73 GiB allocated in private pools (e.g., CUDA Graphs), and 223.25 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Stopping GPU monitoring (PID 246661)
