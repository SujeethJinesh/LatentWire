W1202 17:46:56.665000 1736275 torch/distributed/run.py:793] 
W1202 17:46:56.665000 1736275 torch/distributed/run.py:793] *****************************************
W1202 17:46:56.665000 1736275 torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1202 17:46:56.665000 1736275 torch/distributed/run.py:793] *****************************************
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[W1202 17:47:02.098309796 CUDAAllocatorConfig.h:28] Warning: expandable_segments not supported on this platform (function operator())
[W1202 17:47:02.117016573 CUDAAllocatorConfig.h:28] Warning: expandable_segments not supported on this platform (function operator())
======================================================================
Phase 15: VQ-Telepathy (Discrete Bottleneck)
======================================================================

THE FIX FOR MANIFOLD MISMATCH:
  - Regression (V7): Blurry averages
  - Diffusion Global (V12): Lost details
  - Diffusion Cross-Attn (V13-14): Failed to converge

VQ SOLUTION:
  - Discrete bottleneck prevents blur/drift
  - 4096 codebook entries for rich concepts
  - 1-step inference (no diffusion iteration)

Training: 3000 steps, batch=2
VQ weight: 1.0
======================================================================
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 2180.56it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 7553.90it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:01<00:05,  2.00s/it]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:07,  2.60s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.03s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.18s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.20s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.28s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.56s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.76s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.58s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.85s/it]
Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 5426.01it/s]
Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 6940.38it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:03,  1.88s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:03,  1.88s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:03<00:02,  2.01s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:03<00:02,  2.01s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.02s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.00s/it]
Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.01s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.00s/it]
Target embedding RMS: 0.0027
[PerceiverResampler] 128 latents, 4 layers, 8 heads[PerceiverResampler] 128 latents, 4 layers, 8 heads

[LatentBridgeV15] VQ-Telepathy Bridge
  - src_dim: 4096
  - tgt_dim: 4096
  - num_latents: 128
  - codebook_size: 4096
  - target_rms: 0.0027
[LatentBridgeV15] VQ-Telepathy Bridge
  - src_dim: 4096
  - tgt_dim: 4096
  - num_latents: 128
  - codebook_size: 4096
  - target_rms: 0.0027

Training on 3737 samples
Starting training loop...
V15 VQ-Telepathy:   0%|                                                    | 0/3000 [00:00<?, ?it/s]V15 VQ-Telepathy:   0%|                | 0/3000 [00:02<?, ?it/s, tot=3.78, lm=2.53, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 1/3000 [00:02<2:15:16,  2.71s/it, tot=3.78, lm=2.53, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 1/3000 [00:03<2:15:16,  2.71s/it, tot=4.13, lm=2.88, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 2/3000 [00:03<1:26:03,  1.72s/it, tot=4.13, lm=2.88, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 2/3000 [00:04<1:26:03,  1.72s/it, tot=3.92, lm=2.68, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 3/3000 [00:04<1:10:29,  1.41s/it, tot=3.92, lm=2.68, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 3/3000 [00:05<1:10:29,  1.41s/it, tot=3.96, lm=2.71, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 4/3000 [00:05<1:01:28,  1.23s/it, tot=3.96, lm=2.71, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|      | 4/3000 [00:06<1:01:28,  1.23s/it, tot=3.75, lm=2.50, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|        | 5/3000 [00:06<55:11,  1.11s/it, tot=3.75, lm=2.50, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|        | 5/3000 [00:07<55:11,  1.11s/it, tot=3.35, lm=2.10, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|        | 6/3000 [00:07<54:34,  1.09s/it, tot=3.35, lm=2.10, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|        | 6/3000 [00:08<54:34,  1.09s/it, tot=4.04, lm=2.79, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|        | 7/3000 [00:08<49:55,  1.00s/it, tot=4.04, lm=2.79, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|        | 7/3000 [00:09<49:55,  1.00s/it, tot=3.66, lm=2.41, vq=1.248, ppl=3]V15 VQ-Telepathy:   0%|        | 8/3000 [00:09<47:06,  1.06it/s, tot=3.66, lm=2.41, vq=1.248, ppl=3]V15 VQ-Telepathy:   0%|        | 8/3000 [00:10<47:06,  1.06it/s, tot=3.58, lm=2.33, vq=1.248, ppl=1]V15 VQ-Telepathy:   0%|        | 9/3000 [00:10<49:18,  1.01it/s, tot=3.58, lm=2.33, vq=1.248, ppl=1]V15 VQ-Telepathy:   0%|        | 9/3000 [00:11<49:18,  1.01it/s, tot=3.37, lm=2.13, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|       | 10/3000 [00:11<47:05,  1.06it/s, tot=3.37, lm=2.13, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|       | 10/3000 [00:12<47:05,  1.06it/s, tot=3.55, lm=2.31, vq=1.248, ppl=3]V15 VQ-Telepathy:   0%|       | 11/3000 [00:12<45:02,  1.11it/s, tot=3.55, lm=2.31, vq=1.248, ppl=3]V15 VQ-Telepathy:   0%|       | 11/3000 [00:13<45:02,  1.11it/s, tot=3.11, lm=1.87, vq=1.248, ppl=4]V15 VQ-Telepathy:   0%|       | 12/3000 [00:13<48:25,  1.03it/s, tot=3.11, lm=1.87, vq=1.248, ppl=4]V15 VQ-Telepathy:   0%|       | 12/3000 [00:14<48:25,  1.03it/s, tot=3.53, lm=2.28, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|       | 13/3000 [00:14<46:50,  1.06it/s, tot=3.53, lm=2.28, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|       | 13/3000 [00:14<46:50,  1.06it/s, tot=3.25, lm=2.00, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|       | 14/3000 [00:14<45:06,  1.10it/s, tot=3.25, lm=2.00, vq=1.248, ppl=2]V15 VQ-Telepathy:   0%|       | 14/3000 [00:15<45:06,  1.10it/s, tot=3.36, lm=2.11, vq=1.248, ppl=1]V15 VQ-Telepathy:   0%|       | 15/3000 [00:15<45:35,  1.09it/s, tot=3.36, lm=2.11, vq=1.248, ppl=1]V15 VQ-Telepathy:   0%|       | 15/3000 [00:16<45:35,  1.09it/s, tot=3.28, lm=2.03, vq=1.248, ppl=3]V15 VQ-Telepathy:   1%|       | 16/3000 [00:16<45:21,  1.10it/s, tot=3.28, lm=2.03, vq=1.248, ppl=3]V15 VQ-Telepathy:   1%|       | 16/3000 [00:17<45:21,  1.10it/s, tot=3.75, lm=2.51, vq=1.248, ppl=2]V15 VQ-Telepathy:   1%|       | 17/3000 [00:17<43:54,  1.13it/s, tot=3.75, lm=2.51, vq=1.248, ppl=2]V15 VQ-Telepathy:   1%|       | 17/3000 [00:18<43:54,  1.13it/s, tot=3.76, lm=2.51, vq=1.248, ppl=2]V15 VQ-Telepathy:   1%|       | 18/3000 [00:18<45:41,  1.09it/s, tot=3.76, lm=2.51, vq=1.248, ppl=2]V15 VQ-Telepathy:   1%|       | 18/3000 [00:19<45:41,  1.09it/s, tot=3.65, lm=2.40, vq=1.249, ppl=3]V15 VQ-Telepathy:   1%|       | 19/3000 [00:19<46:11,  1.08it/s, tot=3.65, lm=2.40, vq=1.249, ppl=3]V15 VQ-Telepathy:   1%|       | 19/3000 [00:20<46:11,  1.08it/s, tot=3.48, lm=2.23, vq=1.249, ppl=2]V15 VQ-Telepathy:   1%|       | 20/3000 [00:20<44:46,  1.11it/s, tot=3.48, lm=2.23, vq=1.249, ppl=2]V15 VQ-Telepathy:   1%|       | 20/3000 [00:21<44:46,  1.11it/s, tot=3.67, lm=2.42, vq=1.248, ppl=1]V15 VQ-Telepathy:   1%|       | 21/3000 [00:21<44:37,  1.11it/s, tot=3.67, lm=2.42, vq=1.248, ppl=1]V15 VQ-Telepathy:   1%|       | 21/3000 [00:22<44:37,  1.11it/s, tot=3.32, lm=2.07, vq=1.249, ppl=4]V15 VQ-Telepathy:   1%|       | 22/3000 [00:22<48:32,  1.02it/s, tot=3.32, lm=2.07, vq=1.249, ppl=4]V15 VQ-Telepathy:   1%|       | 22/3000 [00:23<48:32,  1.02it/s, tot=3.44, lm=2.19, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 23/3000 [00:23<46:56,  1.06it/s, tot=3.44, lm=2.19, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 23/3000 [00:24<46:56,  1.06it/s, tot=3.54, lm=2.29, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 24/3000 [00:24<45:45,  1.08it/s, tot=3.54, lm=2.29, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 24/3000 [00:25<45:45,  1.08it/s, tot=3.52, lm=2.27, vq=1.249, ppl=2]V15 VQ-Telepathy:   1%|       | 25/3000 [00:25<47:42,  1.04it/s, tot=3.52, lm=2.27, vq=1.249, ppl=2]V15 VQ-Telepathy:   1%|       | 25/3000 [00:26<47:42,  1.04it/s, tot=3.81, lm=2.56, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 26/3000 [00:26<46:30,  1.07it/s, tot=3.81, lm=2.56, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 26/3000 [00:26<46:30,  1.07it/s, tot=4.33, lm=3.08, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 27/3000 [00:26<44:57,  1.10it/s, tot=4.33, lm=3.08, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 27/3000 [00:27<44:57,  1.10it/s, tot=3.68, lm=2.43, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 28/3000 [00:27<46:58,  1.05it/s, tot=3.68, lm=2.43, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 28/3000 [00:28<46:58,  1.05it/s, tot=3.56, lm=2.31, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 29/3000 [00:28<45:17,  1.09it/s, tot=3.56, lm=2.31, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 29/3000 [00:29<45:17,  1.09it/s, tot=3.89, lm=2.64, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 30/3000 [00:29<44:10,  1.12it/s, tot=3.89, lm=2.64, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 30/3000 [00:30<44:10,  1.12it/s, tot=3.28, lm=2.03, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 31/3000 [00:30<46:42,  1.06it/s, tot=3.28, lm=2.03, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 31/3000 [00:31<46:42,  1.06it/s, tot=3.28, lm=2.03, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 32/3000 [00:31<45:37,  1.08it/s, tot=3.28, lm=2.03, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 32/3000 [00:32<45:37,  1.08it/s, tot=3.40, lm=2.15, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 33/3000 [00:32<43:59,  1.12it/s, tot=3.40, lm=2.15, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 33/3000 [00:33<43:59,  1.12it/s, tot=3.87, lm=2.62, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 34/3000 [00:33<45:55,  1.08it/s, tot=3.87, lm=2.62, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 34/3000 [00:34<45:55,  1.08it/s, tot=3.93, lm=2.68, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 35/3000 [00:34<44:04,  1.12it/s, tot=3.93, lm=2.68, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 35/3000 [00:35<44:04,  1.12it/s, tot=3.33, lm=2.08, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 36/3000 [00:35<43:13,  1.14it/s, tot=3.33, lm=2.08, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 36/3000 [00:36<43:13,  1.14it/s, tot=3.32, lm=2.07, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 37/3000 [00:36<44:51,  1.10it/s, tot=3.32, lm=2.07, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 37/3000 [00:36<44:51,  1.10it/s, tot=3.33, lm=2.08, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 38/3000 [00:36<45:17,  1.09it/s, tot=3.33, lm=2.08, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 38/3000 [00:37<45:17,  1.09it/s, tot=3.24, lm=1.99, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 39/3000 [00:37<44:24,  1.11it/s, tot=3.24, lm=1.99, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 39/3000 [00:38<44:24,  1.11it/s, tot=3.78, lm=2.53, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 40/3000 [00:38<45:07,  1.09it/s, tot=3.78, lm=2.53, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 40/3000 [00:39<45:07,  1.09it/s, tot=3.47, lm=2.22, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 41/3000 [00:39<45:28,  1.08it/s, tot=3.47, lm=2.22, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 41/3000 [00:40<45:28,  1.08it/s, tot=3.18, lm=1.94, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 42/3000 [00:40<43:57,  1.12it/s, tot=3.18, lm=1.94, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 42/3000 [00:41<43:57,  1.12it/s, tot=3.41, lm=2.16, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 43/3000 [00:41<44:01,  1.12it/s, tot=3.41, lm=2.16, vq=1.249, ppl=1]V15 VQ-Telepathy:   1%|       | 43/3000 [00:42<44:01,  1.12it/s, tot=3.17, lm=1.92, vq=1.250, ppl=2]V15 VQ-Telepathy:   1%|       | 44/3000 [00:42<45:59,  1.07it/s, tot=3.17, lm=1.92, vq=1.250, ppl=2]V15 VQ-Telepathy:   1%|       | 44/3000 [00:43<45:59,  1.07it/s, tot=3.06, lm=1.81, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 45/3000 [00:43<45:20,  1.09it/s, tot=3.06, lm=1.81, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 45/3000 [00:44<45:20,  1.09it/s, tot=3.39, lm=2.14, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 46/3000 [00:44<44:56,  1.10it/s, tot=3.39, lm=2.14, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 46/3000 [00:45<44:56,  1.10it/s, tot=3.41, lm=2.16, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 47/3000 [00:45<45:52,  1.07it/s, tot=3.41, lm=2.16, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 47/3000 [00:46<45:52,  1.07it/s, tot=3.74, lm=2.49, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 48/3000 [00:46<44:17,  1.11it/s, tot=3.74, lm=2.49, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 48/3000 [00:46<44:17,  1.11it/s, tot=3.36, lm=2.11, vq=1.248, ppl=2]V15 VQ-Telepathy:   2%|       | 49/3000 [00:46<43:13,  1.14it/s, tot=3.36, lm=2.11, vq=1.248, ppl=2]V15 VQ-Telepathy:   2%|       | 49/3000 [00:47<43:13,  1.14it/s, tot=3.31, lm=2.06, vq=1.250, ppl=1]
[Step 50/3000]
  Total: 3.546
  LM Loss: 2.297
  VQ Loss: 1.2487
  Perplexity: 1.6 (codebook usage)
  LR: 1.00e-04
V15 VQ-Telepathy:   2%|       | 50/3000 [00:47<45:51,  1.07it/s, tot=3.31, lm=2.06, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 50/3000 [00:48<45:51,  1.07it/s, tot=3.19, lm=1.94, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 51/3000 [00:48<44:40,  1.10it/s, tot=3.19, lm=1.94, vq=1.250, ppl=1]V15 VQ-Telepathy:   2%|       | 51/3000 [00:49<44:40,  1.10it/s, tot=3.36, lm=2.12, vq=1.249, ppl=2]V15 VQ-Telepathy:   2%|       | 52/3000 [00:49<43:11,  1.14it/s, tot=3.36, lm=2.12, vq=1.249, ppl=2]V15 VQ-Telepathy:   2%|       | 52/3000 [00:50<43:11,  1.14it/s, tot=3.02, lm=1.77, vq=1.250, ppl=2]V15 VQ-Telepathy:   2%|       | 53/3000 [00:50<46:05,  1.07it/s, tot=3.02, lm=1.77, vq=1.250, ppl=2]V15 VQ-Telepathy:   2%|       | 53/3000 [00:51<46:05,  1.07it/s, tot=3.07, lm=1.82, vq=1.249, ppl=2]V15 VQ-Telepathy:   2%|▏      | 54/3000 [00:51<45:43,  1.07it/s, tot=3.07, lm=1.82, vq=1.249, ppl=2]