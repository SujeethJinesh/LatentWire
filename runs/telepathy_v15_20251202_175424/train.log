W1202 17:54:45.679000 1747199 torch/distributed/run.py:793] 
W1202 17:54:45.679000 1747199 torch/distributed/run.py:793] *****************************************
W1202 17:54:45.679000 1747199 torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1202 17:54:45.679000 1747199 torch/distributed/run.py:793] *****************************************
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
[W1202 17:54:50.995175711 CUDAAllocatorConfig.h:28] Warning: expandable_segments not supported on this platform (function operator())
[W1202 17:54:50.019403488 CUDAAllocatorConfig.h:28] Warning: expandable_segments not supported on this platform (function operator())
======================================================================
Phase 15: VQ-Telepathy (Discrete Bottleneck)
======================================================================

THE FIX FOR MANIFOLD MISMATCH:
  - Regression (V7): Blurry averages
  - Diffusion Global (V12): Lost details
  - Diffusion Cross-Attn (V13-14): Failed to converge

VQ SOLUTION:
  - Discrete bottleneck prevents blur/drift
  - 4096 codebook entries for rich concepts
  - 1-step inference (no diffusion iteration)

Training: 3000 steps, batch=2
VQ weight: 1.0
======================================================================
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 905.26it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 7577.79it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:07,  2.55s/it]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:06,  2.16s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.26s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.12s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.10s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.02s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:06<00:00,  1.54s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:06<00:00,  1.74s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.61s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.85s/it]
Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 6921.29it/s]
Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 7406.07it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:02<00:04,  2.10s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:02<00:04,  2.21s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:04<00:02,  2.10s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:04<00:02,  2.11s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.05s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.07s/it]
Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.07s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:06<00:00,  2.09s/it]
Target embedding RMS: 0.0027
[PerceiverResampler] 128 latents, 4 layers, 8 heads
[PerceiverResampler] 128 latents, 4 layers, 8 heads
[LatentBridgeV15] VQ-Telepathy Bridge[LatentBridgeV15] VQ-Telepathy Bridge
  - src_dim: 4096
  - tgt_dim: 4096
  - num_latents: 128
  - codebook_size: 4096
  - target_rms: 0.0027

  - src_dim: 4096
  - tgt_dim: 4096
  - num_latents: 128
  - codebook_size: 4096
  - target_rms: 0.0027

Training on 3737 samples
Starting training loop...
V15 VQ-Telepathy:   0%|                                                    | 0/3000 [00:00<?, ?it/s]V15 VQ-Telepathy:   0%|               | 0/3000 [00:03<?, ?it/s, tot=3.32, lm=3.32, vq=0.001, ppl=12]V15 VQ-Telepathy:   0%|     | 1/3000 [00:03<2:53:01,  3.46s/it, tot=3.32, lm=3.32, vq=0.001, ppl=12]V15 VQ-Telepathy:   0%|     | 1/3000 [00:04<2:53:01,  3.46s/it, tot=2.87, lm=2.87, vq=0.001, ppl=12]V15 VQ-Telepathy:   0%|     | 2/3000 [00:04<1:47:26,  2.15s/it, tot=2.87, lm=2.87, vq=0.001, ppl=12]V15 VQ-Telepathy:   0%|     | 2/3000 [00:05<1:47:26,  2.15s/it, tot=2.15, lm=2.15, vq=0.001, ppl=14]V15 VQ-Telepathy:   0%|     | 3/3000 [00:05<1:23:25,  1.67s/it, tot=2.15, lm=2.15, vq=0.001, ppl=14]V15 VQ-Telepathy:   0%|     | 3/3000 [00:06<1:23:25,  1.67s/it, tot=2.37, lm=2.37, vq=0.001, ppl=12]V15 VQ-Telepathy:   0%|     | 4/3000 [00:06<1:07:19,  1.35s/it, tot=2.37, lm=2.37, vq=0.001, ppl=12]V15 VQ-Telepathy:   0%|     | 4/3000 [00:07<1:07:19,  1.35s/it, tot=2.30, lm=2.30, vq=0.001, ppl=13]V15 VQ-Telepathy:   0%|     | 5/3000 [00:07<1:02:55,  1.26s/it, tot=2.30, lm=2.30, vq=0.001, ppl=13]V15 VQ-Telepathy:   0%|      | 5/3000 [00:08<1:02:55,  1.26s/it, tot=2.92, lm=2.92, vq=0.001, ppl=3]V15 VQ-Telepathy:   0%|        | 6/3000 [00:08<55:38,  1.12s/it, tot=2.92, lm=2.92, vq=0.001, ppl=3]V15 VQ-Telepathy:   0%|        | 6/3000 [00:09<55:38,  1.12s/it, tot=3.70, lm=3.70, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|        | 7/3000 [00:09<51:36,  1.03s/it, tot=3.70, lm=3.70, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|        | 7/3000 [00:10<51:36,  1.03s/it, tot=3.10, lm=3.10, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|        | 8/3000 [00:10<51:32,  1.03s/it, tot=3.10, lm=3.10, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|        | 8/3000 [00:11<51:32,  1.03s/it, tot=2.61, lm=2.61, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|        | 9/3000 [00:11<48:16,  1.03it/s, tot=2.61, lm=2.61, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|        | 9/3000 [00:12<48:16,  1.03it/s, tot=2.08, lm=2.08, vq=0.001, ppl=3]V15 VQ-Telepathy:   0%|       | 10/3000 [00:12<45:35,  1.09it/s, tot=2.08, lm=2.08, vq=0.001, ppl=3]V15 VQ-Telepathy:   0%|       | 10/3000 [00:13<45:35,  1.09it/s, tot=3.03, lm=3.03, vq=0.001, ppl=1]V15 VQ-Telepathy:   0%|       | 11/3000 [00:13<47:23,  1.05it/s, tot=3.03, lm=3.03, vq=0.001, ppl=1]V15 VQ-Telepathy:   0%|       | 11/3000 [00:13<47:23,  1.05it/s, tot=2.93, lm=2.93, vq=0.001, ppl=1]V15 VQ-Telepathy:   0%|       | 12/3000 [00:13<45:46,  1.09it/s, tot=2.93, lm=2.93, vq=0.001, ppl=1]V15 VQ-Telepathy:   0%|       | 12/3000 [00:14<45:46,  1.09it/s, tot=2.17, lm=2.17, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|       | 13/3000 [00:14<44:17,  1.12it/s, tot=2.17, lm=2.17, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|       | 13/3000 [00:15<44:17,  1.12it/s, tot=1.74, lm=1.74, vq=0.001, ppl=1]V15 VQ-Telepathy:   0%|       | 14/3000 [00:15<45:53,  1.08it/s, tot=1.74, lm=1.74, vq=0.001, ppl=1]V15 VQ-Telepathy:   0%|       | 14/3000 [00:16<45:53,  1.08it/s, tot=2.28, lm=2.28, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|       | 15/3000 [00:16<45:49,  1.09it/s, tot=2.28, lm=2.28, vq=0.001, ppl=2]V15 VQ-Telepathy:   0%|       | 15/3000 [00:17<45:49,  1.09it/s, tot=1.59, lm=1.59, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 16/3000 [00:17<44:45,  1.11it/s, tot=1.59, lm=1.59, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 16/3000 [00:18<44:45,  1.11it/s, tot=1.73, lm=1.73, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 17/3000 [00:18<46:32,  1.07it/s, tot=1.73, lm=1.73, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 17/3000 [00:19<46:32,  1.07it/s, tot=1.44, lm=1.44, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 18/3000 [00:19<46:29,  1.07it/s, tot=1.44, lm=1.44, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 18/3000 [00:20<46:29,  1.07it/s, tot=1.48, lm=1.48, vq=0.001, ppl=2]V15 VQ-Telepathy:   1%|       | 19/3000 [00:20<45:12,  1.10it/s, tot=1.48, lm=1.48, vq=0.001, ppl=2]V15 VQ-Telepathy:   1%|       | 19/3000 [00:21<45:12,  1.10it/s, tot=1.67, lm=1.67, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 20/3000 [00:21<47:16,  1.05it/s, tot=1.67, lm=1.67, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 20/3000 [00:22<47:16,  1.05it/s, tot=2.15, lm=2.15, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 21/3000 [00:22<47:27,  1.05it/s, tot=2.15, lm=2.15, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 21/3000 [00:23<47:27,  1.05it/s, tot=2.28, lm=2.28, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 22/3000 [00:23<46:36,  1.07it/s, tot=2.28, lm=2.28, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 22/3000 [00:24<46:36,  1.07it/s, tot=2.46, lm=2.46, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 23/3000 [00:24<47:03,  1.05it/s, tot=2.46, lm=2.46, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 23/3000 [00:25<47:03,  1.05it/s, tot=2.22, lm=2.22, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 24/3000 [00:25<47:09,  1.05it/s, tot=2.22, lm=2.22, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 24/3000 [00:26<47:09,  1.05it/s, tot=2.82, lm=2.82, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 25/3000 [00:26<46:16,  1.07it/s, tot=2.82, lm=2.82, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 25/3000 [00:27<46:16,  1.07it/s, tot=2.85, lm=2.85, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 26/3000 [00:27<46:33,  1.06it/s, tot=2.85, lm=2.85, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 26/3000 [00:27<46:33,  1.06it/s, tot=2.51, lm=2.51, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 27/3000 [00:27<46:14,  1.07it/s, tot=2.51, lm=2.51, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 27/3000 [00:28<46:14,  1.07it/s, tot=2.57, lm=2.57, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 28/3000 [00:28<44:22,  1.12it/s, tot=2.57, lm=2.57, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 28/3000 [00:29<44:22,  1.12it/s, tot=2.65, lm=2.65, vq=0.001, ppl=2]V15 VQ-Telepathy:   1%|       | 29/3000 [00:29<43:33,  1.14it/s, tot=2.65, lm=2.65, vq=0.001, ppl=2]V15 VQ-Telepathy:   1%|       | 29/3000 [00:30<43:33,  1.14it/s, tot=3.11, lm=3.11, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 30/3000 [00:30<46:44,  1.06it/s, tot=3.11, lm=3.11, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 30/3000 [00:31<46:44,  1.06it/s, tot=2.54, lm=2.54, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 31/3000 [00:31<45:35,  1.09it/s, tot=2.54, lm=2.54, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 31/3000 [00:32<45:35,  1.09it/s, tot=3.09, lm=3.09, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 32/3000 [00:32<44:57,  1.10it/s, tot=3.09, lm=3.09, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 32/3000 [00:33<44:57,  1.10it/s, tot=3.02, lm=3.02, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 33/3000 [00:33<48:35,  1.02it/s, tot=3.02, lm=3.02, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 33/3000 [00:34<48:35,  1.02it/s, tot=2.91, lm=2.91, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 34/3000 [00:34<46:11,  1.07it/s, tot=2.91, lm=2.91, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 34/3000 [00:35<46:11,  1.07it/s, tot=3.31, lm=3.31, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 35/3000 [00:35<44:16,  1.12it/s, tot=3.31, lm=3.31, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 35/3000 [00:36<44:16,  1.12it/s, tot=3.17, lm=3.17, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 36/3000 [00:36<46:31,  1.06it/s, tot=3.17, lm=3.17, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 36/3000 [00:37<46:31,  1.06it/s, tot=3.04, lm=3.04, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 37/3000 [00:37<44:41,  1.11it/s, tot=3.04, lm=3.04, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 37/3000 [00:37<44:41,  1.11it/s, tot=2.95, lm=2.95, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 38/3000 [00:37<43:13,  1.14it/s, tot=2.95, lm=2.95, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 38/3000 [00:38<43:13,  1.14it/s, tot=2.79, lm=2.79, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 39/3000 [00:38<45:29,  1.08it/s, tot=2.79, lm=2.79, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 39/3000 [00:39<45:29,  1.08it/s, tot=2.63, lm=2.63, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 40/3000 [00:39<44:41,  1.10it/s, tot=2.63, lm=2.63, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 40/3000 [00:40<44:41,  1.10it/s, tot=3.06, lm=3.06, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 41/3000 [00:40<43:35,  1.13it/s, tot=3.06, lm=3.06, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 41/3000 [00:41<43:35,  1.13it/s, tot=3.35, lm=3.35, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 42/3000 [00:41<44:22,  1.11it/s, tot=3.35, lm=3.35, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 42/3000 [00:42<44:22,  1.11it/s, tot=2.88, lm=2.88, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 43/3000 [00:42<44:57,  1.10it/s, tot=2.88, lm=2.88, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 43/3000 [00:43<44:57,  1.10it/s, tot=2.95, lm=2.95, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 44/3000 [00:43<44:18,  1.11it/s, tot=2.95, lm=2.95, vq=0.001, ppl=1]V15 VQ-Telepathy:   1%|       | 44/3000 [00:44<44:18,  1.11it/s, tot=2.97, lm=2.97, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 45/3000 [00:44<43:31,  1.13it/s, tot=2.97, lm=2.97, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 45/3000 [00:45<43:31,  1.13it/s, tot=3.02, lm=3.02, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 46/3000 [00:45<45:24,  1.08it/s, tot=3.02, lm=3.02, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 46/3000 [00:46<45:24,  1.08it/s, tot=2.42, lm=2.42, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 47/3000 [00:46<44:14,  1.11it/s, tot=2.42, lm=2.42, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 47/3000 [00:46<44:14,  1.11it/s, tot=2.21, lm=2.21, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 48/3000 [00:46<43:15,  1.14it/s, tot=2.21, lm=2.21, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 48/3000 [00:48<43:15,  1.14it/s, tot=2.28, lm=2.28, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 49/3000 [00:48<45:57,  1.07it/s, tot=2.28, lm=2.28, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 49/3000 [00:48<45:57,  1.07it/s, tot=2.27, lm=2.26, vq=0.001, ppl=1]
[Step 50/3000]
  Total: 2.600
  LM Loss: 2.599
  VQ Loss: 0.0006
  Perplexity: 2.4 (codebook usage)
  LR: 1.00e-04
V15 VQ-Telepathy:   2%|       | 50/3000 [00:48<44:32,  1.10it/s, tot=2.27, lm=2.26, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 50/3000 [00:49<44:32,  1.10it/s, tot=2.39, lm=2.39, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 51/3000 [00:49<43:31,  1.13it/s, tot=2.39, lm=2.39, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 51/3000 [00:50<43:31,  1.13it/s, tot=2.48, lm=2.48, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 52/3000 [00:50<45:55,  1.07it/s, tot=2.48, lm=2.48, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 52/3000 [00:51<45:55,  1.07it/s, tot=2.67, lm=2.67, vq=0.001, ppl=1]V15 VQ-Telepathy:   2%|       | 53/3000 [00:51<44:21,  1.11it/s, tot=2.67, lm=2.67, vq=0.001, ppl=1]