W1104 22:22:56.414000 1834880 torch/distributed/run.py:793] 
W1104 22:22:56.414000 1834880 torch/distributed/run.py:793] *****************************************
W1104 22:22:56.414000 1834880 torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1104 22:22:56.414000 1834880 torch/distributed/run.py:793] *****************************************
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
==== Config ====
source_model: mistralai/Mistral-7B-Instruct-v0.3
target_model: meta-llama/Meta-Llama-3.1-8B-Instruct
translator_type: bottleneck_gated
bottleneck_dim: 1024
soft_tokens: 48
depth: 6
heads: 16
lr: 0.0005
weight_decay: 0.0
train_steps: 2000
warmup_steps: 100
per_device_batch: 10
eval_every: 200
eval_samples: 200
max_new_tokens: 256
seed: 1234
bf16: True
save_path: runs/cross_attention/translator_checkpoint.pt
Loading source model/tokenizer...
Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 920.81it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 5589.92it/s]
Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  2.16it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards:   0%|          | 0/3 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 4100.00it/s]
Downloading shards: 100%|██████████| 3/3 [00:00<00:00, 1806.33it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  2.19it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  2.09it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  2.10it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  2.08it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.23it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.19it/s]
Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  2.15it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  2.15it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  2.14it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.11it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.12it/s]
Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.24it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.23it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.20it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:01<00:00,  2.20it/s]

Loading target model/tokenizer...
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 3463.50it/s]
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 2496.24it/s]
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 1982.19it/s]
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 8881.53it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:01,  1.90it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:01,  1.95it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:01,  1.93it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:01,  1.88it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:01<00:01,  1.95it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:01<00:01,  1.93it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:01<00:01,  1.92it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:01<00:01,  1.91it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:01<00:00,  1.92it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:01<00:00,  1.94it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:01<00:00,  1.92it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:01<00:00,  1.91it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.96it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.94it/s]
Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.98it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.95it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.95it/s]
Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.96it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.94it/s]
Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.94it/s]
Source hidden dim: 4096 | Target hidden dim: 4096
Translator parameters: 142.8M
Loading GSM8K...
Step 20/2000 | Loss (avg over last 20): 8.1663
Step 40/2000 | Loss (avg over last 20): 5.9735
Step 60/2000 | Loss (avg over last 20): 5.4721
Step 80/2000 | Loss (avg over last 20): 5.4657
Step 100/2000 | Loss (avg over last 20): 5.1397
Step 120/2000 | Loss (avg over last 20): 4.9009
Step 140/2000 | Loss (avg over last 20): 4.6951
Step 160/2000 | Loss (avg over last 20): 4.6930
Step 180/2000 | Loss (avg over last 20): 4.7346
Step 200/2000 | Loss (avg over last 20): 4.7148
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/generation/configuration_utils.py:590: UserWarning: `do_sample` is set to `False`. However, `temperature` is set to `0.6` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `temperature`.
  warnings.warn(
/users/sujinesh/.local/lib/python3.10/site-packages/transformers/generation/configuration_utils.py:595: UserWarning: `do_sample` is set to `False`. However, `top_p` is set to `0.9` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `top_p`.
  warnings.warn(
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 200 | Target-alone acc: 0.730 | Bridged acc: 0.165
Step 220/2000 | Loss (avg over last 20): 4.7401
Step 240/2000 | Loss (avg over last 20): 4.7098
Step 260/2000 | Loss (avg over last 20): 4.5962
Step 280/2000 | Loss (avg over last 20): 4.6153
Step 300/2000 | Loss (avg over last 20): 4.6650
Step 320/2000 | Loss (avg over last 20): 4.5823
Step 340/2000 | Loss (avg over last 20): 4.5761
Step 360/2000 | Loss (avg over last 20): 4.6302
Step 380/2000 | Loss (avg over last 20): 4.6182
Step 400/2000 | Loss (avg over last 20): 4.6290
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 400 | Target-alone acc: 0.730 | Bridged acc: 0.055
Step 420/2000 | Loss (avg over last 20): 4.4908
Step 440/2000 | Loss (avg over last 20): 4.4950
Step 460/2000 | Loss (avg over last 20): 4.5489
Step 480/2000 | Loss (avg over last 20): 4.5284
Step 500/2000 | Loss (avg over last 20): 4.5790
Step 520/2000 | Loss (avg over last 20): 4.6144
Step 540/2000 | Loss (avg over last 20): 4.4864
Step 560/2000 | Loss (avg over last 20): 4.5224
Step 580/2000 | Loss (avg over last 20): 4.4870
Step 600/2000 | Loss (avg over last 20): 4.4875
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 600 | Target-alone acc: 0.730 | Bridged acc: 0.185
Step 620/2000 | Loss (avg over last 20): 4.4862
Step 640/2000 | Loss (avg over last 20): 4.4910
Step 660/2000 | Loss (avg over last 20): 4.4420
Step 680/2000 | Loss (avg over last 20): 4.6341
Step 700/2000 | Loss (avg over last 20): 4.4752
Step 720/2000 | Loss (avg over last 20): 4.5222
Step 740/2000 | Loss (avg over last 20): 4.3850
Step 760/2000 | Loss (avg over last 20): 4.4942
Step 780/2000 | Loss (avg over last 20): 4.5695
Step 800/2000 | Loss (avg over last 20): 4.4857
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 800 | Target-alone acc: 0.730 | Bridged acc: 0.060
Step 820/2000 | Loss (avg over last 20): 4.4745
Step 840/2000 | Loss (avg over last 20): 4.5416
Step 860/2000 | Loss (avg over last 20): 4.5295
Step 880/2000 | Loss (avg over last 20): 4.5183
Step 900/2000 | Loss (avg over last 20): 4.4645
Step 920/2000 | Loss (avg over last 20): 4.5357
Step 940/2000 | Loss (avg over last 20): 4.4405
Step 960/2000 | Loss (avg over last 20): 4.4500
Step 980/2000 | Loss (avg over last 20): 4.4666
Step 1000/2000 | Loss (avg over last 20): 4.3900
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 1000 | Target-alone acc: 0.730 | Bridged acc: 0.130
Step 1020/2000 | Loss (avg over last 20): 4.4446
Step 1040/2000 | Loss (avg over last 20): 4.4236
Step 1060/2000 | Loss (avg over last 20): 4.4893
Step 1080/2000 | Loss (avg over last 20): 4.4071
Step 1100/2000 | Loss (avg over last 20): 4.4702
Step 1120/2000 | Loss (avg over last 20): 4.4832
Step 1140/2000 | Loss (avg over last 20): 4.4378
Step 1160/2000 | Loss (avg over last 20): 4.4828
Step 1180/2000 | Loss (avg over last 20): 4.3963
Step 1200/2000 | Loss (avg over last 20): 4.3832
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 1200 | Target-alone acc: 0.730 | Bridged acc: 0.070
Step 1220/2000 | Loss (avg over last 20): 4.4546
Step 1240/2000 | Loss (avg over last 20): 4.4065
Step 1260/2000 | Loss (avg over last 20): 4.3653
Step 1280/2000 | Loss (avg over last 20): 4.4188
Step 1300/2000 | Loss (avg over last 20): 4.4211
Step 1320/2000 | Loss (avg over last 20): 4.3694
Step 1340/2000 | Loss (avg over last 20): 4.3766
Step 1360/2000 | Loss (avg over last 20): 4.3825
Step 1380/2000 | Loss (avg over last 20): 4.3731
Step 1400/2000 | Loss (avg over last 20): 4.3380
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 1400 | Target-alone acc: 0.730 | Bridged acc: 0.070
Step 1420/2000 | Loss (avg over last 20): 4.4072
Step 1440/2000 | Loss (avg over last 20): 4.3829
Step 1460/2000 | Loss (avg over last 20): 4.3729
Step 1480/2000 | Loss (avg over last 20): 4.4143
Step 1500/2000 | Loss (avg over last 20): 4.4454
Step 1520/2000 | Loss (avg over last 20): 4.3902
Step 1540/2000 | Loss (avg over last 20): 4.3529
Step 1560/2000 | Loss (avg over last 20): 4.4211
Step 1580/2000 | Loss (avg over last 20): 4.4428
Step 1600/2000 | Loss (avg over last 20): 4.3552
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 1600 | Target-alone acc: 0.730 | Bridged acc: 0.055
Step 1620/2000 | Loss (avg over last 20): 4.4039
Step 1640/2000 | Loss (avg over last 20): 4.3905
Step 1660/2000 | Loss (avg over last 20): 4.4320
Step 1680/2000 | Loss (avg over last 20): 4.3868
Step 1700/2000 | Loss (avg over last 20): 4.3366
Step 1720/2000 | Loss (avg over last 20): 4.3424
Step 1740/2000 | Loss (avg over last 20): 4.3337
Step 1760/2000 | Loss (avg over last 20): 4.3323
Step 1780/2000 | Loss (avg over last 20): 4.2859
Step 1800/2000 | Loss (avg over last 20): 4.4246
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 1800 | Target-alone acc: 0.730 | Bridged acc: 0.060
Step 1820/2000 | Loss (avg over last 20): 4.4054
Step 1840/2000 | Loss (avg over last 20): 4.3676
Step 1860/2000 | Loss (avg over last 20): 4.3679
Step 1880/2000 | Loss (avg over last 20): 4.3775
Step 1900/2000 | Loss (avg over last 20): 4.4072
Step 1920/2000 | Loss (avg over last 20): 4.4201
Step 1940/2000 | Loss (avg over last 20): 4.3765
Step 1960/2000 | Loss (avg over last 20): 4.3616
Step 1980/2000 | Loss (avg over last 20): 4.4475
Step 2000/2000 | Loss (avg over last 20): 4.3575
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Eval] Step 2000 | Target-alone acc: 0.730 | Bridged acc: 0.060
Saved translator to runs/cross_attention/translator_checkpoint.pt
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
Setting `pad_token_id` to `eos_token_id`:None for open-end generation.
[Final Eval] Target-alone acc: 0.730 | Bridged acc: 0.060
