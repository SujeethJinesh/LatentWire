/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
================================================================================
ARCHITECTURE SWEEP: Diagnose and Fix Mode Collapse
================================================================================

Device: cuda
Samples: 1000, Steps: 300, M: 32

[1/3] Loading frozen LLM...
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 4074.12it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:01<00:04,  1.42s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:02<00:02,  1.19s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:03<00:01,  1.24s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.18it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.00it/s]
  ✓ Model loaded

[2/3] Loading data (SQuAD, n=1000)...
  ✓ Loaded 1000 examples

[3/3] Testing architectures...

================================================================================
Configuration: Direct Sequence Compression (PROPOSED)
================================================================================

Training...
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)
  Step 1/300: loss=9.8773
  Step 51/300: loss=3.6367
  Step 101/300: loss=8.5746
  Step 151/300: loss=4.1620
  Step 201/300: loss=2.4791
  Step 251/300: loss=3.3795
  Step 300/300: loss=4.2672

Evaluating...
/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/generation/configuration_utils.py:601: UserWarning: `do_sample` is set to `False`. However, `temperature` is set to `0.6` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `temperature`.
  warnings.warn(
/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/transformers/generation/configuration_utils.py:606: UserWarning: `do_sample` is set to `False`. However, `top_p` is set to `0.9` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `top_p`.
  warnings.warn(
The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Traceback (most recent call last):
  File "/projects/m000066/sujinesh/LatentWire/scripts/sweep_architectures.py", line 526, in <module>
    main()
  File "/projects/m000066/sujinesh/LatentWire/scripts/sweep_architectures.py", line 461, in main
    result = train_and_evaluate(
  File "/projects/m000066/sujinesh/LatentWire/scripts/sweep_architectures.py", line 373, in train_and_evaluate
    diagnostics = compute_representation_diagnostics(representations)
  File "/projects/m000066/sujinesh/LatentWire/scripts/sweep_architectures.py", line 232, in compute_representation_diagnostics
    cos_sim = cosine_similarity(representations)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/sklearn/utils/_param_validation.py", line 216, in wrapper
    return func(*args, **kwargs)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/sklearn/metrics/pairwise.py", line 1741, in cosine_similarity
    X, Y = check_pairwise_arrays(X, Y)
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/sklearn/metrics/pairwise.py", line 190, in check_pairwise_arrays
    X = Y = check_array(
  File "/projects/m000066/sujinesh/LatentWire/.venv/lib/python3.9/site-packages/sklearn/utils/validation.py", line 1101, in check_array
    raise ValueError(
ValueError: Found array with dim 4. check_pairwise_arrays expected <= 2.
